-- name: test_mv_left_outer_query_inner_rewrite
CREATE TABLE IF NOT EXISTS `customer` (
  `c_custkey` int(11) NULL,
  `c_name` varchar(26) NOT NULL ,
  `c_address` varchar(41) NOT NULL
) ENGINE=OLAP
DUPLICATE KEY(`c_custkey`)
COMMENT "OLAP"
DISTRIBUTED BY HASH(`c_custkey`) BUCKETS 2
PROPERTIES (
"replication_num" = "1"
);
-- result:
-- !result

insert into customer values (1, "name_1", "address_1"), (2, "name_2", "address_2"), (3, "name_3", "address_3"), (null, "name_null", "address_null");
-- result:
-- !result

CREATE TABLE IF NOT EXISTS `lineorder` (
  `lo_orderkey` int(11) NULL,
  `lo_linenumber` int(11) NOT NULL COMMENT "",
  `lo_custkey` int(11) NULL COMMENT "",
  `lo_quantity` int(11) NOT NULL,
  `lo_revenue` int(11) NOT NULL
) ENGINE=OLAP
DUPLICATE KEY(`lo_orderkey`)
COMMENT "OLAP"
DISTRIBUTED BY HASH(`lo_orderkey`) BUCKETS 2
PROPERTIES (
"replication_num" = "1"
);
-- result:
-- !result

insert into t2 values(10001, 1, 1, 10, 1000), (10002, 1, 2, 20, 2000), (10003, 1, 3, 30, 3000), (10004, 1, null, 40, 4000);
-- result:
-- !result

create materialized view mv_left_outer_inner
distributed by hash(`k1`) buckets 10
refresh manual
as
select lo_orderkey, lo_linenumber, lo_quantity, lo_revenue, lo_custkey, c_name
from lineorder left outer join customer
on lo_custkey = c_custkey
-- result:
-- !result
refresh materialized view mv_left_outer_inner with sync mode;
-- result:
-- !result

explain select lo_orderkey, lo_linenumber, lo_quantity, lo_revenue, lo_custkey, c_name
from lineorder left outer join customer
on lo_custkey = c_custkey
where c_name = 'name'
-- result:
[REGEX].*mv_left_outer_inner.*
-- !result